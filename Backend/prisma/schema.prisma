// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Define the ENUM types
enum role_type {
  student
  counselor
  institute
  mentor
}

enum session_type_enum {
  online
  offline
}

enum institute_type_enum {
  private
  govt
  semiGovt
  public
}

enum gender_enum {
  female
  male
  other
}

// Define the Roles model
model roles {
  id        Int       @id @default(autoincrement())
  role_name role_type @unique
  users     users[]

  @@map("roles")
}

// Define the users model
model users {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(100)
  email      String   @unique @db.VarChar(100)
  password   String   @db.VarChar(255) // Ensure this line exists
  role_id    Int?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  role                  roles?                 @relation(fields: [role_id], references: [id])
  student_personal_info student_personal_info?
  student_education     student_education?
  student_interest      student_interest?

  counselor_personal_info counselor_personal_info?
  counselor_education     counselor_education?
  counselor_professional  counselor_professional?

  institute_info institute_info?
  sessions       sessions[]
  programs       programs[]

  student_sessions sessions[] @relation("Studentsessionss")

  counselor_sessions sessions[] @relation("Counselorsessionss")

  mentors mentors[]

  user_traits_status user_traits_status[]

  recommended_careers    recommended_careers[]
  counselor_availability counselor_availability[]
  counselor_bookings     counselor_bookings[]     @relation("counselor_bookings")
  student_bookings       counselor_bookings[]     @relation("student_bookings")

  @@map("users")
}

// Define the Master Subjects model
model master_subjects {
  id           Int    @id @default(autoincrement())
  subject_name String @unique @db.VarChar(100)

  @@map("master_subjects")
}

// Define the Master Sports model
model master_sports {
  id         Int    @id @default(autoincrement())
  sport_name String @unique @db.VarChar(100)

  @@map("master_sports")
}

// Define the Master Hobbies model
model master_hobbies {
  id         Int    @id @default(autoincrement())
  hobby_name String @unique @db.VarChar(100)

  @@map("master_hobbies")
}

// Define the Student Personal Info model
model student_personal_info {
  user_id        Int         @id
  image          String?
  dob            DateTime?
  gender         gender_enum
  location       String?
  contact_number String?

  user users @relation(fields: [user_id], references: [id])

  @@map("student_personal_info")
}

// Define the Student Education model
model student_education {
  user_id     Int    @id
  school_name String @db.VarChar(255)
  class       Int

  user users @relation(fields: [user_id], references: [id])

  @@map("student_education")
}

// Define the Student Interest model
model student_interest {
  user_id     Int   @id
  subject_ids Int[] @default([])
  sport_ids   Int[] @default([])
  hobby_ids   Int[] @default([])

  user users @relation(fields: [user_id], references: [id])

  @@map("student_interest")
}

// Define the Counselor Personal Info model
model counselor_personal_info {
  user_id        Int         @id
  image          String?
  dob            DateTime?
  gender         gender_enum
  location       String?
  contact_number String?

  user users @relation(fields: [user_id], references: [id])

  @@map("counselor_personal_info")
}

// Define the Counselor Education model
model counselor_education {
  user_id     Int    @id
  degree      String @db.VarChar(255)
  certificate String @db.VarChar(50)
  association String @db.VarChar(50)

  user users @relation(fields: [user_id], references: [id])

  @@map("counselor_education")
}

// Define the Counselor Professional model
model counselor_professional {
  user_id            Int     @id
  bio                String?
  year_of_experience Int?
  domain             String?
  image              String?

  user users @relation(fields: [user_id], references: [id])

  @@map("counselor_professional")
}

// Define the sessions model
model sessions {
  session_id   Int  @id @default(autoincrement())
  student_id   Int?
  counselor_id Int?

  session_time DateTime?
  session_date DateTime?

  session_type session_type_enum

  location String @default("remote")

  student users? @relation("Studentsessionss", fields: [student_id], references: [id])

  counselor users? @relation("Counselorsessionss", fields: [counselor_id], references: [id])

  users users[]

  @@map("sessions")
}

// Define the Institute Info model
model institute_info {
  user_id        Int                 @id
  image_url      String?
  address        String?
  contact_number String?
  establish_year Int?
  institute_type institute_type_enum

  student_body String?

  user users @relation(fields: [user_id], references: [id])

  @@map("institute_info")
}

model mentors {
  user_id        Int       @id // Unique identifier for each mentor, linked to users model
  expertise      String? // Area of expertise or specialization
  bio            String? // Short biography or description of the mentor
  created_at     DateTime  @default(now()) // Timestamp when the mentor record was created
  updated_at     DateTime? // Optional timestamp for when the record was last updated
  certifications String[] // Array of URLs for certification images

  user users @relation(fields: [user_id], references: [id]) // Relationship to users model

  mentor_education mentor_education[]

  mentor_professional mentor_professional[]

  @@map("mentors")
}

model mentor_education {
  user_id     Int     @id // Foreign key linking to mentors (and indirectly to users)
  degree      String? // Degree obtained by the mentor
  institution String? // Institution where the degree was obtained

  mentor mentors @relation(fields: [user_id], references: [user_id]) // Relationship to mentors model

  @@map("mentor_education")
}

model mentor_professional {
  user_id            Int              @id // Foreign key linking to mentors (and indirectly to users)
  bio                String? // Biography or description of professional background
  year_of_experience Int? // Years of experience in their field
  type               mentor_type_enum // Type of mentor (Associate or Chief)

  mentor mentors @relation(fields: [user_id], references: [user_id]) // Relationship to mentors model

  @@map("mentor_professional")
}

// New ENUM for mentor types
enum mentor_type_enum {
  associate
  chief
}

// Define the programs model
model programs {
  institute_id                Int     @id
  subjects                    String?
  special_programs            String?
  language_offer              String?
  certificate_and_affiliation String?

  institute users @relation(fields: [institute_id], references: [id])

  @@map("programs")
}

model quiz_questions {
  id         Int      @id @default(autoincrement())
  category   String
  grade      Int
  traits     String?
  question   String   @unique
  answer     String
  options    String[]
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("quiz_questions")
}

model user_traits_status {
  id                  Int      @id @default(autoincrement()) // Unique identifier for each record
  user_id             Int // To associate the record with a specific user
  holland_code_traits String[] // Top Holland Code trait (array of text)
  big_five_traits     String[] // Top Big Five Personality trait (array of text)
  aptitude_status     String? // Aptitude Test status (e.g., Low, Mid, High)
  iq_status           String? // IQ Test status (e.g., Low, Mid, High)
  created_at          DateTime @default(now()) // Timestamp for record creation

  user users @relation(fields: [user_id], references: [id]) // Relationship to users model

  @@map("user_traits_status")
}

model recommended_careers {
  id         Int      @id @default(autoincrement()) // Unique identifier for each record
  user_id    Int // To associate the record with a specific user
  career1    String? // First recommended career
  career2    String? // Second recommended career
  career3    String? // Third recommended career
  created_at DateTime @default(now()) // Timestamp for record creation

  user users @relation(fields: [user_id], references: [id]) // Relationship to users model

  @@map("recommended_careers")
}

model counselor_availability {
  id           Int      @id @default(autoincrement()) // Unique identifier for each entry
  counselor_id Int // ID of the counselor
  date         DateTime @db.Date // Date of availability
  start_time   DateTime @db.Time // Start time of availability
  end_time     DateTime @db.Time // End time of availability
  is_booked    Boolean  @default(false) // Booking status (default is not booked)

  counselor          users                @relation(fields: [counselor_id], references: [id]) // Assuming counselor is a user
  counselor_bookings counselor_bookings[]

  @@map("counselor_availability") // Specify the table name in snake_case
}

model counselor_bookings {
  id                        Int      @id @default(autoincrement()) // Unique identifier for each booking
  student_id                Int // References the users table for the student
  counselor_id              Int // References the users table for the counselor
  counselor_availability_id Int // References the availability table
  date                      DateTime @db.Date // Booking date
  start_time                DateTime @db.Time // Start time of the booking
  end_time                  DateTime @db.Time // End time of the booking
  status                    String   @default("pending") // Status of the booking
  type                      String? // Type of booking (e.g., online, in-person)
  location                  String? // Location of the session
  created_at                DateTime @default(now()) // Timestamp when the booking was created

  student      users                  @relation("student_bookings", fields: [student_id], references: [id]) // Relationship to User model for student
  counselor    users                  @relation("counselor_bookings", fields: [counselor_id], references: [id]) // Relationship to User model for counselor
  availability counselor_availability @relation(fields: [counselor_availability_id], references: [id]) // Relationship to availability

  @@map("counselor_bookings") // Specify the table name in snake_case
}
